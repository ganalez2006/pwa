<!DOCTYPE html>
<html lang="es">
<head>
	<meta charset="UTF-8">
	<title>Test PWA</title>
	<link rel="manifest" href="./manifest.json">
	<link rel="shortcut icon" type="image/x-icon" href="./images/icons/launcher-icon-1x.png"/>

	<meta http-equiv="X-UA-Compatible" content="IE=edge">
	<meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=0" />
	<link rel="profile" href="http://gmpg.org/xfn/11">

	<meta name="apple-mobile-web-app-capable" content="yes" />
	<meta name="apple-mobile-web-app-status-bar-style" content="black" />
</head>
<body>
	<h1>Test PWA</h1>

	<button id="enable" onclick="askNotificationPermission()">Enable notifications</button>

	<hr>

	<a href="image.html">Image</a>
	<a href="otra.html">Otra</a>
	<a href="#" onclick="return show()">Notify me!</a>
	<a href="#" onclick="showNotification()">Notify me!</a>

	<ul id="text"></ul>

	<script src="js/app.js"></script>
	<script>

	"use strict";

	var notificationBtn = document.getElementById('enable');

	if(('permission' in Notification) && (Notification.permission === 'granted') ){
		notificationBtn.style.display = 'none';
	}

	textbox.innerHTML += '<li>' + Notification.permission + '</li>';

	function askNotificationPermission() {


		// function to actually ask the permissions
		function handlePermission(permission) {
			// Whatever the user answers, we make sure Chrome stores the information
			if(!('permission' in Notification)) {
				Notification.permission = permission;
			}

			// set the button to shown or hidden, depending on what the user answers
			if(Notification.permission === 'denied' || Notification.permission === 'default') {
				notificationBtn.style.display = 'block';
			} else {
				notificationBtn.style.display = 'none';
			}

			textbox.innerHTML += '<li>' + Notification.permission + '</li>';
		}

		// Let's check if the browser supports notifications
		if (!"Notification" in window) {
			console.log("This browser does not support notifications.");
			textbox.innerHTML += '<li>This browser does not support notifications.</li>';
		} else {
			if(checkNotificationPromise()) {
				Notification.requestPermission()
				.then((permission) => {
					handlePermission(permission);
				})
			} else {
				Notification.requestPermission(function(permission) {
					handlePermission(permission);
				});
			}
		}
	}

	function checkNotificationPromise() {
		try {
			Notification.requestPermission().then();
		} catch(e) {
			return false;
		}

		return true;
	}


	function showNotification() {
		Notification.requestPermission(function(result) {
			if (result === 'granted') {
				navigator.serviceWorker.ready.then(function(registration) {
					registration.showNotification('Título de la notificación', {
						// occiones
						body: 'Mensaje de la notificación.'
						, icon: './images/icons/launcher-icon-1x.png'
						, tag: 'jgil-pwa-test'
					});
				});
			}
		});
	}
	</script>
</body>
</html>